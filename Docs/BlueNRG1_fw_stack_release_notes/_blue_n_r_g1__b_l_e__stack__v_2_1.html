<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-1,2 Bluetooth Low Energy Stack: BlueNRG-BLE Stack Library v_2_1  (22-June-2018)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-1,2 Bluetooth Low Energy Stack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlueNRG-BLE Stack Library v_2_1 (22-June-2018) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="S1"></a>
Bluetooth Low Energy (BLE) stack binary image files</h1>
<p>This section lists the <b>BlueNRG-BLE Stack Library</b> binary file to be used for the BlueNRG-1, BlueNRG-2 Systems On Chip configuration: <br />
</p>
<ul>
<li>libbluenrg1_stack.a <b>v2.1</b> with following main new features: <ul>
<li>
Qualified Bluetooth LE v.5.0 </li>
<li>
MISRA-C:2012 compliance </li>
<li>
Bluetooth LE Data Packet Length extension support: LL-PDU data payload up to 251 bytes (only for BlueNRG-2 devices) </li>
<li>
BLE stack modular configurations allowing to optimize BLE stack memory footprints based on user application scenario. </li>
</ul>
</li>
<li><b>NOTES</b>: <ul>
<li>
libbluenrg1_stack.a binary library file <b>v2.1</b> is available on folder: <b>Library\Bluetooth_LE\library </b>. The binary file must be linked to the built user application in order to get access to the BLE stack features. </li>
<li>
libbluenrg1_stack.a is valid for all the supported toolchains: IAR-EWARM, ARM Keil MDK and Atollic TrueStudio. </li>
<li>
When adding libbluenrg1_stack.a on a Keil project, just change the related File Type to Library File (from file Options). </li>
<li>
Configuration files stack_user_cfg.[c/h] are used for enabling the BLE stack v2.1 modular approach </li>
<li>
AES CMAC encryption functionality required by BLE stack v2.1 is available on new standalone binary library: Library\cryptolib\cryptolib.a</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="S10"></a>
BLE stack modular configurations options</h2>
<ul>
<li>The following <b>BlueNRG-BLE Stack Library</b> v2.1 modular configurations options are currently supported: <ol>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_STACK_FULL_CONFIGURATION</b> &ndash;&gt; preprocessor option to be added on BLE user application IDE toolchain, for configuring the BLE stack with all supported modular features: <ul>
<li>
Controller Privacy is enabled </li>
<li>
LE Secure Connection is enabled </li>
<li>
Master role is enabled </li>
<li>
Data length extension is enabled (valid only for BlueNRG-2 devices) </li>
</ul>
</li>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION</b> &ndash;&gt; preprocessor option to be added on BLE user application IDE toolchain for configuring the BLE stack with the basic configuration options: <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connection is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is disabled </li>
</ul>
</li>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_OTA_BASIC_CONFIGURATION</b> &ndash;&gt; preprocessor option to be added on BLE user application IDE toolchain for selecting the OTA Service support with Data length extension (valid only for BlueNRG-2 device): <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connections is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is enabled (only for BlueNRG-2 device) </li>
</ul>
</li>
</ol>
</li>
<li>NOTES: <ul>
<li>
Data length extension must be disabled on each configuration related to a BlueNRG-1 device (it doesn't support this feature). </li>
<li>
Files stack_user_cfg.[c/h] must not be modified by user. </li>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION</b> is the default option. If no value is defined for the preprocessor option BLE_STACK_CONFIGURATION on IDE toolchain, the BLE_STACK_BASIC_CONFIGURATION is selected. </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S11"></a>
Bluetooth Low Energy (BLE) stack network coprocessor configuration</h1>
<ul>
<li>Two network coprocessor modes are supported: SPI and UART (mainly for RF evaluation purpose). </li>
<li>The network coprocessor over SPI specification aims at achieving the following targets: <ul>
<li>
Very similar to BlueNRG, BlueNRG-MS protocol </li>
<li>
Power efficient </li>
<li>
Code efficient </li>
<li>
Fast data transfer </li>
</ul>
</li>
<li>DTM project and related workspaces provides reference appplications for configuring the BlueNRG-1 platforms (STEVAL-IDB007Vx (x=1,2)) or BlueNRG-2 platforms (STEVAL-IDB008Vx (x=1,2)) as a network coprocessor (refer to BlueNRG-1_2 DK Release notes documentation for more information).</li>
</ul>
<h1><a class="anchor" id="S12"></a>
New Features</h1>
<p>This section lists the new features compared to <b>BlueNRG-BLE Stack Library</b> v2.0<br />
</p>
<ul>
<li>ID 4109 Library is qualified Bluetooth v.5.0 compliant </li>
<li>ID 3706 Library is compliant to MISRA-C:2012 standard </li>
<li>ID 3287 Modular code: support for Flash memory size requirements of BlueNRG-1 BLE typical applications (OTA FW upgrade framework support) </li>
<li>ID 2381 Support LE Data Packet Length Extension </li>
<li>ID 3413 Export functions that use AES CMAC and AES CCM (refer to binary library cryptolib.a) </li>
<li>ID 3864 Added new offset to aci_hal_write_config_data to set the maximum allowed parameter values for Data Length Extension </li>
<li>ID 1656 New function to freely change attribute permissions: added aci_gatt_set_access_permission() API </li>
<li>ID 2730 New API to remove a specific device from the bonding table </li>
<li>ID 3926 Increased DEFAULT_MAX_ATT_MTU value to 247 Bytes </li>
<li>ID 3295 Emit tone at channel center frequency: added offset parameter to the aci_hal_tone_start() API </li>
<li>ID 3816 Reviewed BLE APIs <a href="../BlueNRG1_BLE_stacks_migration/BlueNRG-1_2_BLE_stack_v2_1_Error_codes.xlsx">error codes</a> </li>
<li>ID 3305 Delay to start advertising when slave connections are active </li>
<li>ID 3574 aci_gatt_tx_pool_available_event generated only when the available buffer size is greater than the maximum ATT MTU </li>
<li>ID 3139 No retry feature: non-standard mechanism to not resend notification packets when not ack'd by the LL of the peer device</li>
</ul>
<ul>
<li>NOTES: <ul>
<li>
Refer to <a href="../BlueNRG1_BLE_stacks_migration/ble__stacks__migration_8h.html">Bluetooth LE Stack v1.x to v2.x migration guideline html documentation </a> for information about how to port an application from BLE stack v1.x to v2.0, v2.1 and later. </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S13"></a>
Solved Issues</h1>
<p>This section lists the solved issues compared to <b>BlueNRG-BLE Stack Library</b> v2.0<br />
</p>
<ul>
<li>ID 3447 The VTimer library does not work correctly if the LS RO is used and its frequency is too high (e.g. at low temperatures). </li>
<li>ID 3216 Timing interpolator malfunction during temperature change: an hardware error event with a timer overrun error may be generated. </li>
<li>ID 4009 Missing check on the size of SDB passed as parameter to Stack Library during initialization (secDbSize parameter). </li>
<li>ID 3892 Device could become unresponsive during scan </li>
<li>ID 3958 Control PDUs accepted also in case Length field value is not valid </li>
<li>ID 3159 hci_le_read_remote_used_features() fails with "Unknown Connection Identifier" when used on a slave device </li>
<li>ID 4026 Supervision timeout reached one Connection Interval earlier than expected. </li>
<li>ID 1688 BlueNRG does not stop advertising immediately, but only after next scheduled packet. </li>
<li>ID 3019 Directed Advertising may last more than 1.28 seconds when an high startup time is used. </li>
<li>ID 2011 Sometimes hci_disconnection_complete_event() is not raised. </li>
<li>ID 3767 When 2 slave links are active occasional disconnections can be observed after a connection parameters update procedure. </li>
<li>ID 2353 When slave latency is different from 0, connection intervals are skipped even there is data to be sent to the master. </li>
<li>ID 3723 Potential issue with receive window calculation when slave slots are canceled. </li>
<li>ID 3223 Not possible to chose advertising channel map with GAP commands </li>
<li>ID 3483 Advertising policy not ignored in direct connectable advertising </li>
<li>ID 3747 Random disconnections following a timer overrun error when RO is used. </li>
<li>ID 3984 The status reported in hci_encryption_change_event() is 0x1A regardless of the error code in LL_REJECT_IND. </li>
<li>ID 3385 hci_read_rssi() command can wrongly return SUCCESS when connHandle input parameter is set to zero </li>
<li>ID 2964 When scan windos is set to 10ms, actual scanning is done only in one chunk of 2.5ms </li>
<li>ID 3218 GATT layer not responding anymore after several invalid L2CAP packets are received (compatibility issue with iPhone 6/7) </li>
<li>ID 3686 L2CAP recombination may fail if received packet are not well formatted:<ul>
<li>
Added new aci_hal_fw_error_event() event </li>
</ul>
</li>
<li>ID 3272 hci_disconnection_complete_event() may be internally discarded and not raised to the application when a lot of events are generated. </li>
<li>ID 2693 aci_hal_end_of_radio_activity always reporting a wrong Last_State equal to Next_State </li>
<li>ID 3165 ACI_HAL_GET_LINK_STATUS reports not initialized values for unused state machines. </li>
<li>ID 4029 When launching write long characteristic procedures with too many data, transfer may hang </li>
<li>ID 3507 If the stack has a "write long characteristic value procedure" ongoing and the connection is lost, the stack remains in an inconsistent state. Following "write long characteristic value" procedures always return 0x46 error code. </li>
<li>ID 3143 Fragmented aci_gatt_attribute_modified_event events generated after an Exec Write Response has been received. </li>
<li>ID 2694 Security requirements not checked before sending Indications or Notifications </li>
<li>ID 4325 Function which handles Find_Info response doesn't manage packet unavailability with proper error code </li>
<li>ID 3387 The «Characteristic» grouping type shall not be used in the ATT Read By Group Type Request. </li>
<li>ID 3921 Issue in parsing received Read Multiple Request if ATT MTU is greater than 23 bytes </li>
<li>ID 3377 ACI_GATT_TX_POOL_AVAILABLE_EVENT not raised if a slave notifies two masters </li>
<li>ID 1681 ACI_GATT_TX_POOL_AVAILABLE_EVENT not raised if the connection is dropped/closed. </li>
<li>ID 4253 ADV packet malformed after an ACI_GAP_SET_DIRECT_CONNECTABLE </li>
<li>ID 3521 Issue with simultaneous scanning and advertising: advertising cannot be stopped after a connection has been established as a master. </li>
<li>ID 3567 Scan sometimes not working with long scan windows </li>
<li>ID 1679 If BlueNRG-1/2 starts a direct connection establishment procedure (aci_gap_create_connection()) while it is advertising, and in the meantime a connection is established with a master, it is not possible to cancel the pending connection. </li>
<li>ID 4071 aci_gap_start_name_discovery_proc() may silently fail if no TX buffer are available. </li>
<li>ID 4011 Address type not checked when searching for a device in the security database.</li>
</ul>
<h1><a class="anchor" id="S14"></a>
Limitations/Bugs</h1>
<p>This section lists the issues known at firmware image release time. Issues found after this release are listed as solved or limitations on newer releases. <br />
</p>
<ul>
<li>ID 2635 Wrong HDC advertising interval in case of long HS STARTUP TIME </li>
<li>ID 3508 Slave latency not applied during LL connection parameter update procedure </li>
<li>ID 4019 Notification issue on multi link scenario </li>
<li>ID 3108 BLE stack v2.1: Controller Privacy is not supported when using a 16MHz HS crystal. </li>
<li>ID 4201 ACI_GATT_DEL_SERVICE doesn't update the attribute size table. </li>
<li>ID 4465 HCI_DISCONNECT and ACI_GAP_TERMINATE return Status=Success also in case of invalid Connection_Handle</li>
</ul>
<h1><a class="anchor" id="S141"></a>
BLE stack Flash memory footprints (bytes)</h1>
<ul>
<li><b>BLE stack full Flash size (all APIs and events used) </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Full Stack Size  </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>98 Kb  </td></tr>
<tr>
<td><b> V2.1 </b> </td><td>102 Kb   </td></tr>
</table>
<ul>
<li><b>BLE Sensor Demo application (BlueNRG-1 case): only BLE stack components Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Release </th><th>LowerApp_OTA </th><th>HigherApp_OTA </th><th>Use_OTA_ServiceManager </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>73 Kb </td><td>Not supported </td><td>Not supported </td><td>Not supported </td></tr>
<tr>
<td><b> V2.1 (FULL stack Configuration) </b> </td><td>77 Kb </td><td>Not supported </td><td>Not supported </td><td>Not supported </td></tr>
<tr>
<td><b> V2.1 (BASIC stack Configuration) </b> </td><td>58 Kb </td><td>58 Kb </td><td>58 Kb </td><td>58 Kb  </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
BlueNRG-1, BLE stack V2.1 Sensor Demo configurations are built with the BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION modular option. </li>
<li>
BLE stack V2.0 applications configurations refer to the full stack size option (no modular options are available on BLE stack V2.0).</li>
</ul>
</li>
</ul>
<ul>
<li><b> OTA Service Manager: total application Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version/(device)</th><th>FULL stack configuration </th><th>BASIC stack configuration </th><th>BASIC stack + extended data length configuration </th></tr>
<tr>
<td><b> V2.0 (BlueNRG-2) </b></td><td>86 Kb </td><td>Not Applicable </td><td>Not Applicable </td></tr>
<tr>
<td><b> V2.1 (BlueNRG-1) </b></td><td>Not supported </td><td>68 Kb </td><td>Not Applicable </td></tr>
<tr>
<td><b> V2.1 (BlueNRG-2) </b></td><td>Not used </td><td>Not used </td><td>70 Kb  </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
OTA Service Manager is not supported on BlueNRG-1, BLE stack v2.0. </li>
<li>
BLE stack V2.0 memory footprints refer to the full stack size option, since no modular options are available on BLE stack V2.0 </li>
<li>
BASIC stack + extended data length configuration (BLE_OTA_BASIC_CONFIGURATION option) enables the Data Length extension feature only on BlueNRG-2 device.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S142"></a>
BTLE_StackTick Time duration (µs)</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>Only Stack Radio Init </th><th>GATT &amp; GAP init </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>66 </td><td>81  </td></tr>
<tr>
<td><b> V2.1 Basic stack </b> </td><td>54 </td><td>65  </td></tr>
<tr>
<td><b> V2.1 Full stack </b> </td><td>73 </td><td>84   </td></tr>
</table>
<h1><a class="anchor" id="S143"></a>
RAL_Isr Time duration (µs): BLE Advertising,  with advertising interval: 100ms; payload size: 28 bytes</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>TX Channel 1 </th><th>RX Channel 1  </th><th>TX Channel 2 </th><th>RX Channel 2  </th><th>TX Channel 3 </th><th>RX Channel 3  </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>33 </td><td>45 </td><td>33 </td><td>45 </td><td>33 </td><td>103  </td></tr>
<tr>
<td><b> V2.1 Basic stack </b> </td><td>35 </td><td>48 </td><td>35 </td><td>48 </td><td>35 </td><td>118  </td></tr>
<tr>
<td><b> V2.1 Full stack </b> </td><td>35 </td><td>48 </td><td>35 </td><td>48 </td><td>35 </td><td>118   </td></tr>
</table>
<h1><a class="anchor" id="S144"></a>
RAL_Isr Time duration (µs): BLE Connection, with connection interval: 100 ms; no data exchange (only empty packets)</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>RX </th><th>TX </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>63 </td><td>132  </td></tr>
<tr>
<td><b> V2.1 Basic stack </b> </td><td>65 </td><td>149  </td></tr>
<tr>
<td><b> V2.1 Full stack </b> </td><td>65 </td><td>149   </td></tr>
</table>
<h1><a class="anchor" id="S145"></a>
BLE Throughput</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>Unidirectional (ATT_MTU size = 23; no Data Length Extension) </th><th>Bidirectional (ATT_MTU size = 23; no Data Length Extension)  </th><th>Unidirectional (ATT_MTU size = 247; Data Length Extension = 251 on Peripheral side)  </th><th>Bidirectional (ATT_MTU size = 247; Data Length Extension = 251 on both Peripheral and Central sides) </th></tr>
<tr>
<td><b> V2.1 </b> </td><td>~220 kbps </td><td>~166 kbps  </td><td>~740kbps  </td><td>~390 kbps   </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
Unidirectional: GAP Peripheral performs characteristic notification to GAP Central. </li>
<li>
Bidirectional: GAP Peripheral performs characteristic notification to GAP Central and GAP Central performs characteristic write without response to GAP Peripheral. </li>
<li>
ATT_MTU size = 247 bytes; Data Length Extension = 251 only on BlueNRG-2 device with BLE stack v2.1 </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S15"></a>
Documentation</h1>
<ul>
<li>Refer to <a href="../BlueNRG1_aci_events/files.html">Bluetooth Low Energy (BLE) API and events html documentation </a> for detailed description of BLE stack APIs and related events callbacks. </li>
<li>Refer to <a href="../BlueNRG1_BLE_stacks_migration/ble__stacks__migration_8h.html">BLE stack migration guidelines from v1.x to v2.x html documentation </a> for guidelines about how to migrate applications from Bluetooth low energy stack v1.x to v2.x. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2020 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
