<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-1,2 Bluetooth Low Energy Stack: BlueNRG-BLE Stack Library v_2_1a (14-December-2018)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-1,2 Bluetooth Low Energy Stack
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlueNRG-BLE Stack Library v_2_1a (14-December-2018) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="S1"></a>
Bluetooth Low Energy (BLE) stack binary image files</h1>
<p>This section lists the <b>BlueNRG-BLE Stack Library</b> binary file to be used for the BlueNRG-1, BlueNRG-2 Systems On Chip configuration: <br />
</p>
<ul>
<li>libbluenrg1_stack.a binary library <b>v2.1a</b> with following main new features: <ul>
<li>
MISRA-C:2012 compliance </li>
<li>
Bluetooth LE Data Packet Length extension support: LL-PDU data payload up to 251 bytes (only for BlueNRG-2 devices). </li>
<li>
BLE stack modular configurations allowing to optimize BLE stack memory footprints based on user application scenario. </li>
</ul>
</li>
<li><b>NOTES</b>: <ul>
<li>
libbluenrg1_stack.a binary library file <b>v2.1a</b> is available on folder: <b>Library\Bluetooth_LE\library </b>. The binary file must be linked to the built user application in order to get access to the BLE stack features. </li>
<li>
libbluenrg1_stack.a is valid for all the supported toolchains: IAR-EWARM, ARM Keil MDK and Atollic TrueStudio. </li>
<li>
When adding libbluenrg1_stack.a on a Keil project, just change the related File Type to Library File (from file Options). </li>
<li>
Configuration files stack_user_cfg.[c/h] are used for enabling the BLE stack v2.1a modular approach </li>
<li>
AES CMAC encryption functionality required by BLE stack v2.1a is available on new standalone binary library: Library\cryptolib\cryptolib.a</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="S10"></a>
BLE stack modular configurations options</h2>
<ul>
<li>The following <b>BlueNRG-BLE Stack Library</b> modular configurations options are currently supported: <ol>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_STACK_FULL_CONFIGURATION</b> &ndash;&gt; preprocessor option to be added on BLE user application IDE toolchain, for configuring the BLE stack with all supported modular features: <ul>
<li>
Controller Privacy is enabled </li>
<li>
LE Secure Connection is enabled </li>
<li>
Master role is enabled </li>
<li>
Data length extension is enabled (valid only for BlueNRG-2 devices) </li>
</ul>
</li>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION</b> &ndash;&gt; preprocessor option to be added on BLE user application IDE toolchain for configuring the BLE stack with the basic configuration options: <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connection is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is disabled </li>
</ul>
</li>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_OTA_BASIC_CONFIGURATION</b> &ndash;&gt; preprocessor option to be added on BLE user application IDE toolchain for selecting the OTA Service support with Data length extension (valid only for BlueNRG-2 device): <ul>
<li>
Controller Privacy is disabled </li>
<li>
LE Secure Connections is disabled </li>
<li>
Master role is disabled (only Peripheral/Slave role is supported) </li>
<li>
Data length extension is enabled (only for BlueNRG-2 device) </li>
</ul>
</li>
</ol>
</li>
<li>NOTES: <ul>
<li>
Data length extension must be disabled on each configuration related to a BlueNRG-1 device (it doesn't support this feature). </li>
<li>
Files stack_user_cfg.[c/h] must not be modified by user. </li>
<li>
<b>BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION</b> is the default option. If no value is defined for the preprocessor option BLE_STACK_CONFIGURATION on IDE toolchain, the BLE_STACK_BASIC_CONFIGURATION is selected. </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S11"></a>
Bluetooth Low Energy (BLE) stack network coprocessor configuration</h1>
<ul>
<li>Two network coprocessor modes are supported: SPI and UART (mainly for RF evaluation purpose). </li>
<li>The network coprocessor over SPI specification aims at achieving the following targets: <ul>
<li>
Very similar to BlueNRG, BlueNRG-MS protocol </li>
<li>
Power efficient </li>
<li>
Code efficient </li>
<li>
Fast data transfer </li>
</ul>
</li>
<li>DTM project and related workspaces provides reference appplications for configuring the BlueNRG-1 platforms (STEVAL-IDB007Vx (x=1,1M,2)) or BlueNRG-2 platforms (STEVAL-IDB008Vx (x=1,2)) as a network coprocessor (refer to BlueNRG-1_2 DK Release notes documentation for more information).</li>
</ul>
<h1><a class="anchor" id="S12"></a>
New Features</h1>
<p>This section lists the new features compared to <b>BlueNRG-BLE Stack Library</b> v2.1<br />
</p>
<ul>
<li>None</li>
</ul>
<ul>
<li>NOTES: <ul>
<li>
Refer to <a href="../BlueNRG1_BLE_stacks_migration/ble__stacks__migration_8h.html">Bluetooth LE Stack v1.x to v2.x migration guideline html documentation </a> for information about how to port an application from BLE stack v1.x to v2.0, v2.1x and later. </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S13"></a>
Solved Issues</h1>
<p>This section lists the solved issues compared to <b>BlueNRG-BLE Stack Library</b> v2.1<br />
</p>
<ul>
<li>ID 4303: <b> Bluetooth Pairing vulnerability (Secure Connections) issue </b> </li>
<li>ID 4800: Remote Public Key Validation to be added to LL_Get_Supported_Features </li>
<li>ID 4565: Reset of local SMP status in case of not successful Pairing </li>
<li>ID 5228: Master/Initiator Pairing Request behavior when receiving a Slave Security Request: <ul>
<li>
Pairing Request bonding and MITM fields shall be set to a value such that satisfies the Authentication Requirements coming from the device performing Slave Security Request; </li>
<li>
Secure Connection support and Key Press Notification Support subfields, which indicates an actual capability of the device, shall not be modified in the Pairing Request Packet.</li>
</ul>
</li>
<li>ID 5284: aci_gap_pairing_complete_event has to be returned even after an encryption is initiated by the peer (master) and it fails because key is locally missing. </li>
<li>ID 4084: Command ACI_GAP_SET_DIRECT_CONNECTABLE should ignore Adv_Interval values in case of high duty cycle directed advertising </li>
<li>ID 4652: ACI_GAP_START_CONNECTION_UPDATE fails if Minimum_CE_Length and Maximum_CE_Length are set to a value that is less than 3 </li>
<li>ID 4465: HCI_DISCONNECT and ACI_GAP_TERMINATE return Status=Success also in case of invalid Connection_Handle </li>
<li>ID 4616: If a new master slot has to be allocated, it is always allocated at the beginning of the anchor period and can collide with other already allocated master slots. </li>
<li>ID 4866: MD bit always set if a LL command is not acknowledged by the peer device </li>
<li>ID 4884: BlueNRG does not enter sleep in LL_ONLY mode</li>
</ul>
<h1><a class="anchor" id="S14"></a>
Limitations/Bugs</h1>
<p>This section lists the issues known at firmware image release time. Issues found after this release are listed as solved or limitations on newer releases. <br />
</p>
<ul>
<li>ID 2635 Wrong HDC advertising interval in case of long HS STARTUP TIME </li>
<li>ID 3508 Slave latency not applied during LL connection parameter update procedure </li>
<li>ID 4019 Notification issue on multi link scenario </li>
<li>ID 3108 BLE stack v2.x: Controller Privacy is not supported when using a 16MHz HS crystal. </li>
<li>ID 4201 ACI_GATT_DEL_SERVICE doesn't update the attribute size table.</li>
</ul>
<h1><a class="anchor" id="S141"></a>
BLE stack Flash memory footprints (bytes)</h1>
<ul>
<li><b>BLE stack full Flash size (all APIs and events used) </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Full Stack Size  </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>98 Kb  </td></tr>
<tr>
<td><b> V2.1x </b> </td><td>102 Kb   </td></tr>
</table>
<ul>
<li><b>BLE Sensor Demo application (BlueNRG-1 case): only BLE stack components Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version </th><th>Release </th><th>LowerApp_OTA </th><th>HigherApp_OTA </th><th>Use_OTA_ServiceManager </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>73 Kb </td><td>Not supported </td><td>Not supported </td><td>Not supported </td></tr>
<tr>
<td><b> V2.1x (FULL stack Configuration) </b> </td><td>77 Kb </td><td>Not supported </td><td>Not supported </td><td>Not supported </td></tr>
<tr>
<td><b> V2.1x (BASIC stack Configuration) </b> </td><td>58 Kb </td><td>58 Kb </td><td>58 Kb </td><td>58 Kb  </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
BlueNRG-1, BLE stack V2.1x Sensor Demo configurations are built with the BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION modular option. </li>
<li>
BLE stack V2.0 applications configurations refer to the full stack size option (no modular options are available on BLE stack V2.0).</li>
</ul>
</li>
</ul>
<ul>
<li><b> OTA Service Manager: total application Flash size </b></li>
</ul>
<table  border="1">
<tr>
<th>Stack version/(device)</th><th>FULL stack configuration </th><th>BASIC stack configuration </th><th>BASIC stack + extended data length configuration </th></tr>
<tr>
<td><b> V2.0 (BlueNRG-2) </b></td><td>86 Kb </td><td>Not Applicable </td><td>Not Applicable </td></tr>
<tr>
<td><b> V2.1x (BlueNRG-1) </b></td><td>Not supported </td><td>68 Kb </td><td>Not Applicable </td></tr>
<tr>
<td><b> V2.1x (BlueNRG-2) </b></td><td>Not used </td><td>Not used </td><td>70 Kb  </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
OTA Service Manager is not supported on BlueNRG-1, BLE stack v2.0. </li>
<li>
BLE stack V2.0 memory footprints refer to the full stack size option, since no modular options are available on BLE stack V2.0 </li>
<li>
BASIC stack + extended data length configuration (BLE_OTA_BASIC_CONFIGURATION option) enables the Data Length extension feature only on BlueNRG-2 device.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S142"></a>
BTLE_StackTick Time duration (µs)</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>Only Stack Radio Init </th><th>GATT &amp; GAP init </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>66 </td><td>81  </td></tr>
<tr>
<td><b> V2.1x Basic stack </b> </td><td>54 </td><td>65  </td></tr>
<tr>
<td><b> V2.1x Full stack </b> </td><td>73 </td><td>84   </td></tr>
</table>
<h1><a class="anchor" id="S143"></a>
RAL_Isr Time duration (µs): BLE Advertising,  with advertising interval: 100ms; payload size: 28 bytes</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>TX Channel 1 </th><th>RX Channel 1  </th><th>TX Channel 2 </th><th>RX Channel 2  </th><th>TX Channel 3 </th><th>RX Channel 3  </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>33 </td><td>45 </td><td>33 </td><td>45 </td><td>33 </td><td>103  </td></tr>
<tr>
<td><b> V2.1x Basic stack </b> </td><td>35 </td><td>48 </td><td>35 </td><td>48 </td><td>35 </td><td>118  </td></tr>
<tr>
<td><b> V2.1x Full stack </b> </td><td>35 </td><td>48 </td><td>35 </td><td>48 </td><td>35 </td><td>118   </td></tr>
</table>
<h1><a class="anchor" id="S144"></a>
RAL_Isr Time duration (µs): BLE Connection, with connection interval: 100 ms; no data exchange (only empty packets)</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>RX </th><th>TX </th></tr>
<tr>
<td><b> V2.0 </b> </td><td>63 </td><td>132  </td></tr>
<tr>
<td><b> V2.1x Basic stack </b> </td><td>65 </td><td>149  </td></tr>
<tr>
<td><b> V2.1x Full stack </b> </td><td>65 </td><td>149   </td></tr>
</table>
<h1><a class="anchor" id="S145"></a>
BLE Throughput</h1>
<table  border="1">
<tr>
<th>Stack version </th><th>Unidirectional (ATT_MTU size = 23; no Data Length Extension) </th><th>Bidirectional (ATT_MTU size = 23; no Data Length Extension)  </th><th>Unidirectional (ATT_MTU size = 247; Data Length Extension = 251 on Peripheral side)  </th><th>Bidirectional (ATT_MTU size = 247; Data Length Extension = 251 on both Peripheral and Central sides) </th></tr>
<tr>
<td><b> V2.1x </b> </td><td>~220 kbps </td><td>~166 kbps  </td><td>~740kbps  </td><td>~390 kbps   </td></tr>
</table>
<ul>
<li><b> NOTES</b>: <ul>
<li>
Unidirectional: GAP Peripheral performs characteristic notification to GAP Central. </li>
<li>
Bidirectional: GAP Peripheral performs characteristic notification to GAP Central and GAP Central performs characteristic write without response to GAP Peripheral. </li>
<li>
ATT_MTU size = 247 bytes; Data Length Extension = 251 only on BlueNRG-2 device with BLE stack v2.1x </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S15"></a>
Documentation</h1>
<ul>
<li>Refer to <a href="../BlueNRG1_aci_events/files.html">Bluetooth Low Energy (BLE) API and events html documentation </a> for detailed description of BLE stack APIs and related events callbacks. </li>
<li>Refer to <a href="../BlueNRG1_BLE_stacks_migration/ble__stacks__migration_8h.html">BLE stack migration guidelines from v1.x to v2.x html documentation </a> for guidelines about how to migrate applications from Bluetooth low energy stack v1.x to v2.x. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2020 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
