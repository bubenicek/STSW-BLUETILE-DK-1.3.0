<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueNRG-1,2 Development kits (STSW-BLUENRG1-DK): 4) Design &amp; Bringing Up custom BlueNRG-1,2 PCB</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueNRG-1,2 Development kits (STSW-BLUENRG1-DK)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">4) Design &amp; Bringing Up custom BlueNRG-1,2 PCB </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="S4"></a>
Design custom PCB</h1>
<ul>
<li>The RF performance and the critical maximum peak voltage, spurious and harmonic emission, receiver matching strongly depend on the PCB layout as well as the selection of the matching network components. </li>
<li>For optimal performance, it is recommended the use of the PCB layout design hints described on the <a href="http://www.st.com/resource/en/application_note/dm00263000.pdf">PCB design guidelines for the BlueNRG-1,2 device Application Note (AN4819). </a> </li>
<li>Further, it is strongly suggested to use the BOM defined in the reference design, which guarantee, with a good PCB design, the correct RF performances. </li>
<li><a href="http://www.st.com/content/st_com/en/products/evaluation-tools/solution-evaluation-tools/communication-and-connectivity-solution-eval-boards/steval-idb007v2.html">BlueNRG-1, STEVAL-IDB007V2 </a>platforms web pages provide the reference schematics, BOM and gerber files. </li>
<li><a href="http://www.st.com/content/st_com/en/products/evaluation-tools/solution-evaluation-tools/communication-and-connectivity-solution-eval-boards/steval-idb008v1.html">BlueNRG-2, STEVAL-IDB008V1</a>, <a href="http://www.st.com/content/st_com/en/products/evaluation-tools/solution-evaluation-tools/communication-and-connectivity-solution-eval-boards/steval-idb008v2.html">BlueNRG-2, STEVAL-IDB008V2</a>, <a href="https://www.st.com/content/st_com/en/products/evaluation-tools/solution-evaluation-tools/communication-and-connectivity-solution-eval-boards/steval-idb009v1.html">BlueNRG-248, STEVAL-IDB009V1</a> platforms web pages provide the reference schematics, BOM and gerber files. </li>
<li>Refer to the <a href="http://www.st.com/resource/en/datasheet/bluenrg-1.pdf ">BlueNRG-1 datasheet </a> and <a href="http://www.st.com/resource/en/datasheet/bluenrg-2.pdf ">BlueNRG-2 datasheet </a>for the available I/O pins and the peripherals I/O mapping.</li>
</ul>
<h1><a class="anchor" id="S4_1"></a>
Test custom PCB</h1>
<ul>
<li>In order to finalize customer PCB design with BlueNRG-1,2 devices, some reference <a class="anchor" id="bringing_up"></a>tests must be performed: <ul>
<li>
Power supply and current consumption tests </li>
<li>
HS_Startup_Time test </li>
<li>
High Speed Crystal and Low Speed Crystal centering tests </li>
<li>
Output power test </li>
<li>
Packet exchange test </li>
<li>
Sensitivity test </li>
<li>
Power consumption in advertising mode test </li>
</ul>
</li>
</ul>
<ul>
<li>It is recommended to make available a set of test points in order to measure the performance of the device on the customer PCB. Depending on customer PCB constraints, it may not always be possible to add all test points, in which case some tests cannot be performed. </li>
<li>Refer to the <a href="http://www.st.com/resource/en/application_note/dm00262995.pdf">Bringing up the BlueNRG-1,2 device Application Note (AN4818)</a> for detailed description about each test item and required test points. </li>
<li>User is requested to use some specific demonstration applications (DTM, demo application going on sleep mode) in order to properly configure the custom PCB for each specific bringing up test. Refer to next section about general guidelines about how to configure a test or demonstration application on a custom PCB. </li>
<li>NOTE: RF regulations compliance (FCC, ETSI, ARIB) according to the market region should be followed: references application notes are available on <a href="http://www.st.com/bluenrg-1">BlueNRG-1 </a> and <a href="http://www.st.com/bluenrg-2">BlueNRG-2 </a> web pages.</li>
</ul>
<h2><a class="anchor" id="S4_1_1"></a>
How to configure a test or demonstration application on a custom PCB?</h2>
<ul>
<li>In order to properly configure a test application or demonstration application on a custom PCB, some basic application configuration parameters must be defined, based on selected custom PCB layout: <ul>
<li>
High speed crystal source: 16MHz or 32MHz </li>
<li>
Low speed crystal source: external 32 kHz oscillator or internal RO </li>
<li>
SMPS configuration: enabled (with 10 μH or 4.7 μH) or disabled </li>
</ul>
</li>
</ul>
<ul>
<li>The following table provide the basic/mandatory preprocessor options to be configured, based on custom PCB:</li>
</ul>
<table  border="1">
<tr>
<th>Application Configuration Options </th><th>Preprocessor Option &amp; Value </th><th>Note  </th></tr>
<tr>
<td><b> High speed crystal source </b></td><td>HS_SPEED_XTAL=HIGH_FREQ_32M </td><td>PCB high speed crystal = 32MHz </td></tr>
<tr>
<td><b> High speed crystal source </b></td><td>HS_SPEED_XTAL=HIGH_FREQ_16M </td><td>PCB high speed crystal = 16MHz (default configuration) </td></tr>
<tr>
<td><b> Low speed crystal source </b></td><td>LS_SOURCE=LS_SOURCE_EXTERNAL_32kHZ </td><td>PCB low speed crystal = external 32 kHz oscillator (default configuration) </td></tr>
<tr>
<td><b> Low speed crystal source </b></td><td>LS_SOURCE=LS_SOURCE_INTERNAL_RO </td><td>PCB low speed crystal = internal RO </td></tr>
<tr>
<td><b> SMPS configuration </b></td><td>SMPS_INDUCTOR = SMPS_10uH_PMU </td><td>PCB SMPS inductor: SMPS enabled with 10 μH (default configuration) </td></tr>
<tr>
<td><b> SMPS configuration </b></td><td>SMPS_INDUCTOR = SMPS_INDUCTOR_4_7uH </td><td>PCB SMPS inductor: SMPS enabled with 4.7 μH </td></tr>
<tr>
<td><b> SMPS configuration </b></td><td>SMPS_INDUCTOR = SMPS_INDUCTOR_NONE </td><td>PCB SMPS inductor disabled  </td></tr>
</table>
<ul>
<li>NOTEs: <ul>
<li>
Refer to <a href="http://www.st.com/resource/en/programming_manual/dm00294449.pdf">BlueNRG-1,2 BLE stack programming guidelines (PM0257) </a>, BlueNRG-1, BlueNRG-2 application configuration section for a detailed and complete list of available application configuration options and related values. </li>
<li>
BlueNRG-BLE Stack Library (STMicrolectronics BLE stack) v2.1 or later allows to optimize BLE stack memory footprints based on user application scenario. User can select the BLE stack v2.1 or later modular configuration through the BLE_STACK_CONFIGURATION preprocessor option which allows to enable/disable Controller Privacy, enable/disable LE secure Connections, enable/disable Master role, enable/disable data length extension. For information about the supported BLE stack v2.1 or later modular configuration options and how to enable them, refer to the <a href="../BlueNRG1_aci_events/stack__user__cfg_8h.html">BLE stack modular configuration options file </a>. </li>
<li>
Default BLE stack v2.1 or later modular configuration option is BLE_STACK_CONFIGURATION=BLE_STACK_BASIC_CONFIGURATION: controller privacy, LE secure connections, Master role, data length extension features all disabled. </li>
</ul>
</li>
</ul>
<ul>
<li>Once the proper application configuration options have been identified, user can adapt/port a BlueNRG-1,2 SDK <a href="http://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/stsw-bluenrg1-dk.html">(STSW-BLUENRG1-DK) </a> test or demonstration application for building and running on a custom PCB following these steps: <ol>
<li>
Open the selected SW environment (IDE) and the related application project </li>
<li>
From the original project configuration, create a new project configuration for specific custom PCB (i.e. call it as: User_PCB) </li>
<li>
On the new User_PCB project configuration, add the previously described application configuration preprocessor options for selected High speed crystal and Low speed crystal sources, SMPS configuration </li>
<li>
On the new User_PCB project configuration, add the proper BLE stack v2.1 or later modular configuration option (default configuration is BLE_STACK_BASIC_CONFIGURATION). </li>
<li>
On the new User_PCB project configuration, add the preprocessor option: USER_DEFINED_PLATFORM=USER_EVAL_PLATFORM </li>
<li>
Open the header file USER_Platform_Configuration.h available on BlueNRG-1_2 DK SW package, <a href="http://www.st.com/content/st_com/en/products/embedded-software/evaluation-tool-software/stsw-bluenrg1-dk.html">STSW-BLUENRG1-DK </a>, on folder Library\SDK_Eval_BlueNRG1\inc. </li>
<li>
Customize the USER_Platform_Configuration.h according to the required custom PCB I/O lines </li>
<li>
Perform all other required customization for properly support the custom PCB HW resources (i.e. add support for specific custom PCB sensors, ...) </li>
<li>
Built, download and run the binay application on custom PCB and play with it! </li>
</ol>
</li>
</ul>
<ul>
<li>NOTEs: During application debugging/testing it is recommended to follow the <a href="../BlueNRG-1_Debugging_Guidelines/BlueNRG-1_Debugging_Guidelines.html">BlueNRG-1,2 BLE application debugging tips </a>.</li>
</ul>
<h2><a class="anchor" id="S4_1_2"></a>
Production tests</h2>
<ul>
<li>Once customer reference design is finalized and qualified, on production tests, an automatic subset of the reference <a href="#bringing_up">tests </a> can be performed before programming and testing the final program: <ul>
<li>
High Speed Crystal centering test </li>
<li>
Output power test </li>
<li>
Packet exchange test </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="S5"></a>
BLE Product qualification</h1>
<ul>
<li>BlueNRG-1, BlueNRG-2 are BLE qualified <a class="anchor" id="certification"></a> devices:<ul>
<li>
For detailed information about the available Qualified Designs QDID refer to the <a href="https://www.bluetooth.com/develop-with-bluetooth/qualification-listing">Bluetooth Low Energy</a> web page, select <a href="https://launchstudio.bluetooth.com/Listings/Search">FIND A PRODUCT</a> link, and type BlueNRG on "Advanced Search" tab.</li>
</ul>
</li>
</ul>
<ul>
<li>Due to Bluetooth SIG regulations, if a user is integrating ST BLE certified components, he would first have to purchase a declaration ID: <ul>
<li>
Use the reference QDID for the ST BLE stack qualified Host+Link Layer component for the BlueNRG-1, BlueNRG-2 family devices. </li>
<li>
Qualify his PCB/hardware design (SIG RF-PHY testing) on a certified test house with associated cost. </li>
<li>
If user adds a proprietary profile then testing would not be needed as it wouldn’t be covered in the SIG’s standard profile list. </li>
<li>
If user includes a BLE SIG GATT standard profile, user has to qualify it on a test house according to SIG test procedure with related costs.</li>
</ul>
</li>
</ul>
<ul>
<li>More detailed information can be found on the following Bluetooth web link: <ul>
<li>
<a href="https://www.bluetooth.com/develop-with-bluetooth/qualification-listing">Qualify Your Product</a> web page </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2020 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
