<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Multiple Connections Formula: 1) Multiple master and slave devices connection parameters definition</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Multiple Connections Formula
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">1) Multiple master and slave devices connection parameters definition </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>BlueNRG-1, BlueNRG-2 BLE stack multiple master/slave feature offers the capability for one device (called Master_Slave in this context), to handle up to 8 connections at same time, as follow: <ol>
<li>
Master of multiple Slaves: <ul>
<li>
One Master device connected up to 8 Slaves devices (Master device is not a slave of any other Master devices) </li>
</ul>
</li>
<li>
Simultaneously Advertising/Scanning and Master of multiple Slaves: <ul>
<li>
One Master/Slave device connected as a Slave to one Master device and as a Master up to 7 Slaves devices </li>
<li>
One Master/Slave device connected as a Slave to two Master devices and as a Master up to 6 Slaves devices </li>
</ul>
</li>
</ol>
</li>
</ul>
<table  border="0">
<tr>
<th></th></tr>
<tr>
<td><div class="image">
<img src="Figure_1.png" />
</div>
   </td></tr>
<tr align="center">
<td><b style="font-size: 18px; color:blue;"> Figure 1: Master_Slave multiple &amp; simultaneously advertising/scanning scenarios </b>  </td></tr>
</table>
<ul>
<li>In order to address the highlighted scenarios, user must properly defines the advertising/scanning and connection parameters for calculating the optimized anchor period allowing to handle the required multiple Master_Slave connection scenario. </li>
<li>A specific formula allows to calculate the required advertising/scanning and connection parameters on the highlighted scenarios, where one device (Master_Slave) is managing up to Num_Masters Masters devices, up to Num_Slaves slaves devices and doing advertising and scanning with Scan_window length. </li>
<li>The formula is defined as follow (on file Library\BLE_Application\src\ble_utils.c): <ul>
<li>
<b>GET_Master_Slave_device_connection_parameters(Num_Masters, Num_Slaves, Scan_Window, Sleep_Time)</b></li>
</ul>
</li>
<li>User is requested to provide the following inputs parameters, based on his specific application scenario:</li>
</ul>
<ul>
<li><b>Table 1: Input parameters for defining Master_Slave device connections parameters </b> <table  border="1">
<tr>
<th>Input parameter </th><th>Description </th><th>Allowed range </th><th>NOTE </th></tr>
<tr>
<td><b> Num_Masters </b> </td><td>Number of Masters device to which the Master/Slave should be connected as Slave, including the non-connectable advertising </td><td>[0-2] </td><td>If 0, Master device is not Slave of any other Master device: it can connect up to 8 Slaves devices at same time  </td></tr>
<tr>
<td><b> Num_Slaves </b> </td><td>Number of Slaves device to which the Master/Slave should be connected as Master </td><td>[0 â€“ Allowed_Slaves]  </td><td>The max number of Slaves devices depends on how many Master devices Master_Slave device is expected to be connected: Allowed_Slaves = 8 - Num_Masters  </td></tr>
<tr>
<td><b> Scan_Window</b> </td><td>Master_Slave device scan window length in ms </td><td>[2.5 - 10240] ms </td><td>This input value defines the minimum selected scanning window for Master_Slave device.  </td></tr>
<tr>
<td><b> Sleep_time </b> </td><td>Additional time (ms) to be added to the minimum required Anchor Period  </td><td>[0-N] ms  </td><td>0: no additional time is added to the minimum Anchor Period (which defines the optimized configuration for throughput)   </td></tr>
</table>
</li>
</ul>
<ul>
<li>When user selects Sleep_Time = 0, the <b>GET_Master_Slave_device_connection_parameters()</b> formula defines the optimized Master_Slave device connections parameters in order to satisfy the required multiple connection scenarios and keeping the best possible data throughput. If user wants to enhance the power consumption profile, he can add a specific time through the Sleep_Time parameter, which leads to increase the device connection parameters with a benefit on power consumption but with lower data throughput. </li>
<li>Based on the provided input parameters, the formula calculates the following Master_Slave device connections parameters: <ul>
<li>
Connection_Interval </li>
<li>
CE_Length </li>
<li>
Advertising_Interval </li>
<li>
Scan_Interval </li>
<li>
Scan_Window </li>
<li>
AnchorPeriodLength </li>
</ul>
</li>
</ul>
<ul>
<li><b> Table 2: Output parameters for Master_Slave device multiple connections </b> <table  border="1">
<tr>
<th>Output parameter </th><th>Description </th><th>Allowed range/time(ms) </th><th>How to use </th></tr>
<tr>
<td><b> Connection_Interval </b> </td><td>Connection Event Interval Minimum value for the connection event interval. </td><td>Values: 0x0006 (7.50 ms) ... 0x0C80 (4000.00 ms).Time = N * 1.25 msec. </td><td>Value to be used for the Conn_Interval_Min, Conn_Interval_Max parameters of create connections APIs (i.e.: ACI_GAP_CREATE_CONNECTION() )  </td></tr>
<tr>
<td><b> CE_Length </b> </td><td>Length of connection needed for this LE connection. </td><td>Time = N * 0.625 msec </td><td>Value to be used for the Minimum_CE_Length, Maximum_CE_Length parameters of create connections APIs (i.e.: ACI_GAP_CREATE_CONNECTION()) </td></tr>
<tr>
<td><b> Advertising_Interval </b> </td><td>Advertising Interval </td><td>Values: 0x0020 (20.000 ms) ... 0x4000 (10240.000 ms). Time = N * 0.625 msec. </td><td>Value to be used for the Advertising_Interval_Min, Advertising_Interval_Max parameters of discovery mode , connectable mode APIs (i.e. :ACI_GAP_SET_DISCOVERABLE(), ..)  </td></tr>
<tr>
<td><b> Scan_Interval </b> </td><td>Scanning Interval  </td><td>Values: 0x0004 (2.500 ms) ... 0x4000 (10240.000 ms) Time = N * 0.625 msec.  </td><td>Value to be used for the LE_Scan_Interval parameter of discovery procedures (i.e.: ACI_GAP_CREATE_CONNECTION(),ACI_GAP_START_GENERAL_DISCOVERY_PROC(), ..)  </td></tr>
<tr>
<td><b> Scan_Window </b> </td><td>Scanning Window  </td><td>Values: 0x0004 (2.500 ms) ... 0x4000 (10240.000 ms) Time = N * 0.625 msec.  </td><td>Value to be used for the LE_Scan_Window parameter of discovery procedures (i.e.: ACI_GAP_CREATE_CONNECTION(), ACI_GAP_START_GENERAL_DISCOVERY_PROC(), ..)  </td></tr>
<tr>
<td><b> AnchorPeriodLength </b> </td><td>Minimum time interval used to represent all the periodic Master slots associated to Master_Slave device  </td><td></td><td>It is calculated from <b>GET_Master_Slave_device_connection_parameters()</b> formula based on input parameters, and it used for defining the device connections output parameters.   </td></tr>
</table>
</li>
</ul>
<ul>
<li>Assumptions: <ol>
<li>
Formula defines internally the number of packets, at maximum length, that can be exchanged with each slave per connection interval (6). </li>
</ol>
</li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2020 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
