<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Multiple Connections Guidelines: Multiple_Connections_Guidelines.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="STcustom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ST-logo-small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Multiple Connections Guidelines
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Multiple_Connections_Guidelines.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>This document describes the basic guidelines to be followed in order to address multiple connection scenarios using BlueNRG-1, BlueNRG-2 devices, when performing the following BLE operations:</p><ul>
<li>Advertising</li>
<li>Scanning</li>
<li>Connections</li>
<li>Simultaneously Advertising/Scanning</li>
</ul>
<h1><a class="anchor" id="Basics"></a>
Table 1: Common concepts for Guidelines</h1>
<table  id="DoxyEmbeddedTable" border="1">
<tr id="HeadRow">
<td id="FirstColumn"><b>Term</b></td><td id="MiddleColumn"><b>Description</b></td><td id="LastColumn"><b>Notes</b> </td></tr>
<tr id="BodyRow">
<td id="FirstColumn">Slot</td><td id="MiddleColumn">It is a time window where an event occurs. Slots are classified as: <br />
 - Master slots (Scanning, Master Connection and Advertising events); <br />
 - Slave slots (Slave Connection events).</td><td id="LastColumn">For a Slave slot the position within the Anchor Period is predictable but not constant since it is decided by the Master device. <br />
Slave Slot Periodicity is independent from the Anchor Period and it can overlap in time with other Master slots: <br />
 - a round-robin policy is adopted by the FW whenever a collision is predicted. </td></tr>
<tr id="LastRow">
<td id="FirstColumn">Anchor Period</td><td id="MiddleColumn">It is the minimum time interval used to represent all the periodic Master slots associated to a device (time is be represented as a repetition of Anchor Periods)</td><td id="LastColumn">The Anchor Period is started at the same time the first Master slot is scheduled </td></tr>
</table>
<h1><a class="anchor" id="Advertising"></a>
Table 2: Advertising Guidelines</h1>
<table  id="DoxyEmbeddedTable" border="1">
<tr id="HeadRow">
<td id="FirstColumn"><b>Conditions</b></td><td id="MiddleColumn"><b>Guidelines</b></td><td id="LastColumn"><b>Notes</b> </td></tr>
<tr id="BodyRow">
<td id="FirstColumn">A1: Advertising is the first slot to start</td><td id="MiddleColumn">1. Try not to choose a very short advertising interval since it restricts the probability to allocate successive Master slots</td><td id="LastColumn">Advertising determines the anchor period. <br />
Make sure advertising length does not exceed the anchor period. </td></tr>
<tr id="LastRow">
<td id="FirstColumn">A2: Advertising is not the first Master Slot</td><td id="MiddleColumn">1. If Direct Advertising, check that selected interval range includes an integer multiple of the shortest allocated connection interval (otherwise advertising slot is not be allocated)<br />
 2. If not Direct Advertising, choose Advertising_Interval_Min = Advertising_Interval_Max such that (Advertising_Interval_Min + 5ms) is an integer multiple of the shortest allocated connection interval</td><td id="LastColumn">Make sure advertising length does not exceed the anchor period </td></tr>
</table>
<h1><a class="anchor" id="Scanning"></a>
Table 3: Scanning Guidelines</h1>
<table  id="DoxyEmbeddedTable" border="1">
<tr id="HeadRow">
<td id="FirstColumn"><b>Condtions</b></td><td id="MiddleColumn"><b>Guidelines</b></td><td id="LastColumn"><b>Notes</b> </td></tr>
<tr id="BodyRow">
<td id="FirstColumn">S1: No existing master slots</td><td id="MiddleColumn">1. No limitations for LE_Scan_Interval and LE_Scan_Window. <br />
 2. If simultaneously advertising and scanning, it is preferably choose LE_Scan_Window such that it is at least 18 milliseconds lower than LE_Scan_Interval (for allowing an Advertising slots to be allocated while Scanning is active)</td><td id="LastColumn"></td></tr>
<tr id="BodyRow">
<td id="FirstColumn">S2: Existing Master slots</td><td id="MiddleColumn">1. Choose a LE_Scan_Interval greater or equal to the periodicity (i.e. Advertising Interval or Connection Interval) of one of the existing Master slots</td><td id="LastColumn"></td></tr>
<tr id="LastRow">
<td id="FirstColumn">S3: Existing Slave slots</td><td id="MiddleColumn">1. Choose a LE_Scan_Interval equal to the minimum Slave slot periodicity (this will help the round-robin algorithm to serve the Slave slots)</td><td id="LastColumn"></td></tr>
</table>
<h1><a class="anchor" id="Master"></a>
Table 4: Master Connection Guidelines Guidelines</h1>
<table  id="DoxyEmbeddedTable" border="1">
<tr id="HeadRow">
<td id="FirstColumn"><b>Conditions</b></td><td id="MiddleColumn"><b>Guidelines</b></td><td id="LastColumn"><b>Notes</b> </td></tr>
<tr id="BodyRow">
<td id="FirstColumn">M1: First slot</td><td id="MiddleColumn">1. The Anchor Period is started when the first Master connection is created: <br />
 a) Anchor Period will be the mean value between Connection_Interval_Min and Connection_Interval_Max; <br />
 b) Slot is placed at the beginning of the Anchor Period; <br />
 c) Slot Length is set equal to the maximum of the requested connection length (i.e. Maximum_CE_Length) <br />
 2.The relative Length of the first Master Connection slot compared to the Anchor Period limits the possibility to allocate further Master slots: <br />
 a) Advice is to request a Slot Length that takes into account the most probable Length of a connection event and not the worst one (i.e. longest but very low probable). In other words, shorter Connection Length is preferable.</td><td id="LastColumn"></td></tr>
<tr id="LastRow">
<td id="FirstColumn">M2: Not first slot</td><td id="MiddleColumn">1. Since the Anchor Period is already in place, the Host needs to have a clear understanding of the current Anchor Period and Allowed_Length: <br />
 a) Choose Connection_Interval_Min and Connection_Interval_Max such that the interval range includes either an integer multiple or an integer divider of the current Anchor Period; <br />
 b) Choose Minimum_CE_Length and Maximum_CE_Length in such a way not to exceed the Anchor Period. <br />
 2. Since a reduction of the Anchor Period also reduces the possibility to allocate new slots, preferably choose the maximum Connection Interval among the allowed ones for the target application. In other words, longer Connection Interval is preferable.</td><td id="LastColumn"></td></tr>
</table>
<h1><a class="anchor" id="Advertising_Scanning"></a>
Table 5: Master Connection Guidelines when simultaneously Advertising/Scanning</h1>
<table  id="DoxyEmbeddedTable" border="1">
<tr id="HeadRow">
<td id="FirstColumn"><b>Conditions</b></td><td id="MiddleColumn"><b>Guidelines</b></td><td id="LastColumn"><b>Notes</b> </td></tr>
<tr id="BodyRow">
<td id="FirstColumn">SSAdv1: Advertising is started first and then there is a connectable Scanning</td><td id="MiddleColumn">1. Try not to choose a very short Advertising Interval since it restricts the probability to allocate successive Master slots</td><td id="LastColumn">1. Anchor Period is decided by the Advertising since it started first: scanning automatically uses the same Anchor Period; <br />
 2. Scan slot is removed when the connection is established and consequently the Scan slot Length is considered available in this case (i.e. Used_Length does not include the Scanning slot Length). </td></tr>
<tr id="LastRow">
<td id="FirstColumn">SSAdv2: Scanning is started first and then there is Advertising</td><td id="MiddleColumn">1. Choose Scan Window so that there is room for an Advertising slot; <br />
 2. The Advertising Interval must be an integer multiple of the Scan Interval</td><td id="LastColumn"></td></tr>
</table>
<h1><a class="anchor" id="Slave_of_Two_Masters"></a>
Table 6: Slave of Multiple Masters (up to 2 Masters)</h1>
<table  id="DoxyEmbeddedTable" border="1">
<tr id="HeadRow">
<td id="FirstColumn"><b>Conditions</b></td><td id="MiddleColumn"><b>Guidelines</b></td><td id="LastColumn"><b>Notes</b> </td></tr>
<tr id="LastRow">
<td id="FirstColumn">SoMM2: Slave of 2 Master devices</td><td id="MiddleColumn">1. For connection to second master, choose a LE_Scan_Interval equal to the minimum Slave slot periodicity (this help the round-robin algorithm to serve the Slave slots)</td><td id="LastColumn">The position within the Anchor Period is predictable but not constant since it is decided by the two Master devices. <br />
Periodicity is independent from the Anchor Period and it can overlap in time each other as well as with other Master slots: <br />
a) A round-robin policy is adopted by the FW whenever a collision is predicted between two Slave slots </td></tr>
</table>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 2020 by STMicrolectronics. All rights reserved.<br>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
